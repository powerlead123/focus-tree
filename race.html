<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>口算竞速</title>
    <link rel="stylesheet" href="race.css">
</head>
<body>
    <!-- 设置页面 -->
    <div id="setupScreen" class="screen">
        <div class="container">
            <h1>🏎️ 口算竞速</h1>
            
            <div class="setup-section">
                <label class="setup-label">比赛模式</label>
                <div class="mode-options">
                    <label class="mode-option">
                        <input type="radio" name="raceMode" value="manual" checked>
                        <span class="mode-option-content">
                            <span class="mode-option-icon">✋</span>
                            <span class="mode-option-text">手动模式<br><small>家长点击按钮</small></span>
                        </span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="raceMode" value="auto">
                        <span class="mode-option-content">
                            <span class="mode-option-icon">🧮</span>
                            <span class="mode-option-text">答题模式<br><small>网页自动出题</small></span>
                        </span>
                    </label>
                </div>
            </div>

            <div class="setup-section">
                <label class="setup-label">题目数量</label>
                <input type="number" id="questionCount" class="input-number" value="20" min="1" max="100">
                <span class="unit">题</span>
            </div>

            <div class="setup-section">
                <div class="section-header">
                    <label class="setup-label">对手设置</label>
                    <button id="manageNamesBtn" class="btn-link">管理名字池</button>
                </div>
                <div class="lottery-info">
                    <p>对手数量：<input type="number" id="opponentCount" class="input-number-small" value="2" min="1" max="5"> 个</p>
                    <p>速度范围：<input type="number" id="minSpeed" class="input-number-small" value="3" min="1" max="30"> - 
                    <input type="number" id="maxSpeed" class="input-number-small" value="8" min="1" max="30"> 秒/题</p>
                </div>
                <button id="lotteryBtn" class="btn btn-lottery">🎲 开始摇号</button>
                <div id="selectedOpponents" class="selected-opponents"></div>
            </div>

            <div class="setup-section">
                <label class="setup-label">选择背景（可选）</label>
                <div id="raceBackgroundSelector" class="background-options-race"></div>
            </div>

            <div class="button-group">
                <button id="startRaceBtn" class="btn btn-primary btn-large">开始比赛</button>
                <button id="viewHistoryBtn" class="btn btn-secondary">查看记录墙</button>
                <button id="backBtn" class="btn btn-secondary" onclick="window.location.href='home.html'">返回首页</button>
            </div>
        </div>
    </div>

    <!-- 倒计时幕布 -->
    <div id="countdownCurtain" class="countdown-curtain hidden">
        <div class="curtain-left"></div>
        <div class="curtain-right"></div>
        <div class="countdown-number" id="countdownNumber">3</div>
    </div>

    <!-- 比赛页面 -->
    <div id="raceScreen" class="screen hidden">
        <div class="race-container">
            <div class="race-header">
                <h2>🏎️ 口算竞速</h2>
                <div class="race-timer">已用时间：<span id="raceTime">00:00</span></div>
                <button id="exitRaceBtn" class="btn-exit">退出</button>
            </div>

            <!-- 宠物加油区 -->
            <div class="pet-cheering-area" id="petCheeringArea">
                <div class="cheering-pet" id="cheeringPet">🥚</div>
                <div class="cheering-bubble" id="cheeringBubble">加油！</div>
            </div>

            <div class="race-track-container">
                <div class="track-markers">
                    <span class="marker-start">🏁 起点</span>
                    <span class="marker-end">终点 🏆</span>
                </div>
                <div id="raceTracks" class="race-tracks"></div>
            </div>

            <div class="race-controls">
                <!-- 手动模式按钮 -->
                <button id="completeBtn" class="btn btn-complete">完成一题</button>
                
                <!-- 答题模式界面 -->
                <div id="answerPanel" class="answer-panel hidden">
                    <div class="question-display">
                        <div class="question-text" id="questionText">8 + 5 × 3 = ?</div>
                        <div class="answer-input-display" id="answerDisplay">_</div>
                    </div>
                    
                    <div class="number-keyboard">
                        <button class="num-btn" data-num="7">7</button>
                        <button class="num-btn" data-num="8">8</button>
                        <button class="num-btn" data-num="9">9</button>
                        <button class="num-btn" data-num="4">4</button>
                        <button class="num-btn" data-num="5">5</button>
                        <button class="num-btn" data-num="6">6</button>
                        <button class="num-btn" data-num="1">1</button>
                        <button class="num-btn" data-num="2">2</button>
                        <button class="num-btn" data-num="3">3</button>
                        <button class="num-btn num-btn-wide" data-num="0">0</button>
                        <button class="num-btn" id="backspaceBtn">←</button>
                        <button class="num-btn num-btn-submit" id="submitAnswerBtn">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 结果页面 -->
    <div id="resultScreen" class="screen hidden">
        <div class="container">
            <h1>🎉 比赛结束！</h1>
            
            <div class="result-summary">
                <div class="rank-display" id="rankDisplay"></div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">总用时</span>
                        <span class="stat-value" id="totalTime">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">平均每题</span>
                        <span class="stat-value" id="avgTime">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">超越对手</span>
                        <span class="stat-value" id="beatCount">--</span>
                    </div>
                </div>
            </div>

            <div class="ranking-list">
                <h3>最终排名</h3>
                <div id="finalRanking"></div>
            </div>

            <div class="encouragement" id="encouragement"></div>

            <div class="button-group">
                <button id="playAgainBtn" class="btn btn-primary">再来一局</button>
                <button id="backToHomeBtn" class="btn btn-secondary">返回</button>
            </div>
        </div>
    </div>

    <!-- 名字池管理弹窗 -->
    <div id="namesModal" class="modal hidden">
        <div class="modal-content">
            <h2>管理名字池</h2>
            
            <div id="namesManageList" class="manage-list"></div>
            
            <button id="addNameBtn" class="btn btn-secondary">+ 添加新名字</button>
            <button id="closeNamesModalBtn" class="btn btn-link">关闭</button>
        </div>
    </div>

    <!-- 编辑名字弹窗 -->
    <div id="editNameModal" class="modal hidden">
        <div class="modal-content modal-small">
            <h2 id="editNameTitle">添加名字</h2>
            
            <div class="form-group">
                <label>名字</label>
                <input type="text" id="nameInput" class="input-text" placeholder="例如：妈妈、爸爸、姐姐" maxlength="10">
            </div>
            
            <div class="button-group">
                <button id="saveNameBtn" class="btn btn-primary">保存</button>
                <button id="cancelNameBtn" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 摇号动画弹窗 -->
    <div id="lotteryModal" class="modal hidden">
        <div class="modal-content lottery-modal">
            <h2>🎲 正在摇号...</h2>
            
            <div class="lottery-progress">
                <span id="lotteryProgress">准备中...</span>
            </div>
            
            <div class="lottery-boxes">
                <!-- 名字摇号箱 -->
                <div class="lottery-box">
                    <div class="box-title">📝 名字池</div>
                    <div class="lottery-display">
                        <div class="lottery-value" id="lotteryName">?</div>
                    </div>
                    <div class="box-status" id="nameStatus">等待中...</div>
                </div>
                
                <!-- 速度摇号箱 -->
                <div class="lottery-box">
                    <div class="box-title">⚡ 速度池</div>
                    <div class="lottery-display">
                        <div class="lottery-value" id="lotterySpeed">?</div>
                    </div>
                    <div class="box-status" id="speedStatus">等待中...</div>
                </div>
            </div>
            
            <div class="lottery-results">
                <h3>已摇出的对手</h3>
                <div id="lotteryResultList"></div>
            </div>
            
            <button id="cancelLotteryBtn" class="btn btn-secondary" style="margin-top: 15px;">取消摇号</button>
        </div>
    </div>

    <!-- 记录墙弹窗 -->
    <div id="historyModal" class="modal hidden">
        <div class="modal-content history-modal">
            <h2>🏆 比赛记录墙</h2>
            
            <div class="history-stats">
                <div class="stat-card">
                    <div class="stat-icon">🎯</div>
                    <div class="stat-info">
                        <div class="stat-label">总比赛次数</div>
                        <div class="stat-value" id="totalRaces">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🥇</div>
                    <div class="stat-info">
                        <div class="stat-label">获胜次数</div>
                        <div class="stat-value" id="winCount">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⚡</div>
                    <div class="stat-info">
                        <div class="stat-label">最快记录</div>
                        <div class="stat-value" id="bestTime">--</div>
                    </div>
                </div>
            </div>

            <div class="history-list" id="historyList"></div>
            
            <div class="button-group">
                <button id="clearHistoryBtn" class="btn btn-danger btn-small">清空记录</button>
                <button id="closeHistoryBtn" class="btn btn-secondary">关闭</button>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="race.js"></script>
</body>
</html>
