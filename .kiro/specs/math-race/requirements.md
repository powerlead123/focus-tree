# 口算竞速功能需求文档

## 简介

口算竞速是一个游戏化的口算练习功能，通过赛车竞赛的形式激励孩子快速完成口算题目。孩子在作业本上完成口算题后，家长帮忙点击按钮推进进度，与虚拟对手进行比赛。

## 术语表

- **系统**：专注小树应用
- **用户**：使用应用的孩子
- **家长**：协助操作的成年人
- **比赛对手**：虚拟的竞争对象（如妈妈、爸爸、AI助手）
- **题目**：需要完成的口算题数量
- **赛道**：显示比赛进度的可视化界面
- **手动模式**：家长点击按钮推进进度的比赛模式
- **答题模式**：孩子在网页上答题推进进度的比赛模式
- **混合运算**：包含加减乘除的数学表达式

## 需求

### 需求 1：入口选择

**用户故事：** 作为用户，我想在开始任务时选择口算竞速模式，以便进行游戏化的口算练习

#### 验收标准

1. WHEN 用户打开任务输入弹窗，THE 系统 SHALL 显示两个选项："专注作业"和"口算竞速"
2. WHEN 用户选择"口算竞速"，THE 系统 SHALL 进入口算竞速设置页面
3. WHEN 用户选择"专注作业"，THE 系统 SHALL 保持原有的专注作业流程

### 需求 2：比赛设置

**用户故事：** 作为用户，我想设置题目数量和选择比赛对手，以便开始适合我的比赛

#### 验收标准

1. WHEN 用户进入口算竞速设置页面，THE 系统 SHALL 显示题目数量输入框
2. WHEN 用户输入题目数量，THE 系统 SHALL 接受1-100之间的整数
3. WHEN 用户进入口算竞速设置页面，THE 系统 SHALL 显示比赛模式选择："手动模式"和"答题模式"
4. WHEN 用户进入口算竞速设置页面，THE 系统 SHALL 显示已保存的比赛对手列表
5. WHEN 用户选择比赛对手，THE 系统 SHALL 允许选择1-5个对手
6. WHEN 用户完成设置并点击"开始比赛"，THE 系统 SHALL 验证至少输入了题目数量
7. WHEN 用户完成设置并点击"开始比赛"，THE 系统 SHALL 进入比赛页面

### 需求 3：比赛界面显示

**用户故事：** 作为用户，我想看到清晰的赛道和进度，以便了解比赛状态

#### 验收标准

1. WHEN 比赛开始，THE 系统 SHALL 显示用户和所有选中对手的赛道
2. WHEN 比赛进行中，THE 系统 SHALL 在每条赛道上显示参赛者名称、汽车图标和进度条
3. WHEN 比赛进行中，THE 系统 SHALL 显示每个参赛者已完成的题目数量
4. WHEN 比赛进行中，THE 系统 SHALL 在顶部显示已用时间
5. WHEN 比赛进行中，THE 系统 SHALL 在底部显示"完成一题"按钮

### 需求 4：用户进度推进

**用户故事：** 作为家长，我想通过点击按钮推进孩子的进度，以便记录孩子完成的题目

#### 验收标准

1. WHEN 家长点击"完成一题"按钮，THE 系统 SHALL 将用户的汽车向前移动固定距离
2. WHEN 家长点击"完成一题"按钮，THE 系统 SHALL 增加用户已完成题目的计数
3. WHEN 用户完成的题目数达到设定总数，THE 系统 SHALL 停止接受点击
4. WHEN 用户的汽车移动，THE 系统 SHALL 显示平滑的动画效果

### 需求 5：对手自动推进

**用户故事：** 作为用户，我想看到对手自动前进，以便感受到竞争压力

#### 验收标准

1. WHEN 比赛开始，THE 系统 SHALL 根据每个对手的设定速度自动推进其进度
2. WHEN 对手完成一题，THE 系统 SHALL 将对手的汽车向前移动固定距离
3. WHEN 对手完成一题，THE 系统 SHALL 增加对手已完成题目的计数
4. WHEN 对手完成的题目数达到设定总数，THE 系统 SHALL 停止该对手的自动推进

### 需求 6：比赛结束

**用户故事：** 作为用户，我想在比赛结束时看到结果和排名，以便了解自己的表现

#### 验收标准

1. WHEN 用户完成所有题目，THE 系统 SHALL 结束比赛
2. WHEN 比赛结束，THE 系统 SHALL 显示所有参赛者的最终排名
3. WHEN 比赛结束，THE 系统 SHALL 显示用户的总用时和平均每题用时
4. WHEN 比赛结束，THE 系统 SHALL 显示用户超越了多少个对手
5. WHEN 比赛结束，THE 系统 SHALL 显示鼓励性的反馈信息
6. WHEN 比赛结束，THE 系统 SHALL 提供"再来一局"和"返回"按钮
7. WHEN 比赛进行中且对手完成所有题目，THE 系统 SHALL 继续允许用户完成比赛

### 需求 7：对手管理

**用户故事：** 作为用户，我想添加和编辑比赛对手，以便自定义比赛难度

#### 验收标准

1. WHEN 用户进入对手管理页面，THE 系统 SHALL 显示已保存的对手列表
2. WHEN 用户点击"添加对手"，THE 系统 SHALL 显示对手编辑表单
3. WHEN 用户填写对手信息，THE 系统 SHALL 要求输入姓名和每题用时（秒）
4. WHEN 用户保存对手，THE 系统 SHALL 验证姓名不为空且每题用时为正整数
5. WHEN 用户保存对手，THE 系统 SHALL 将对手信息存储到本地
6. WHEN 用户点击编辑对手，THE 系统 SHALL 显示该对手的当前信息
7. WHEN 用户修改对手信息并保存，THE 系统 SHALL 更新对手数据
8. WHEN 用户删除对手，THE 系统 SHALL 从列表中移除该对手
9. THE 系统 SHALL 预设三个默认对手：妈妈（5秒）、爸爸（8秒）、AI助手（3秒）
10. WHEN 对手自动推进时，THE 系统 SHALL 在设定速度基础上添加±20%的随机波动

### 需求 8：数据持久化

**用户故事：** 作为用户，我想系统记录我的比赛历史，以便查看进步

#### 验收标准

1. WHEN 比赛结束，THE 系统 SHALL 保存比赛记录到本地存储
2. WHEN 保存比赛记录，THE 系统 SHALL 包含日期、题目数量、用时、排名信息
3. THE 系统 SHALL 保留最近20条比赛记录

### 需求 9：答题模式 - 题目生成

**用户故事：** 作为用户，我想在答题模式中由系统自动出题，以便进行真实的口算练习

#### 验收标准

1. WHEN 用户选择答题模式并开始比赛，THE 系统 SHALL 自动生成指定数量的口算题目
2. WHEN 系统生成题目，THE 系统 SHALL 生成三个数字的混合运算表达式
3. WHEN 表达式包含乘法，THE 系统 SHALL 确保两个因数都不超过10
4. WHEN 表达式包含除法，THE 系统 SHALL 确保被除数不超过100且能整除
5. WHEN 表达式包含加减法，THE 系统 SHALL 确保参与运算的数不超过100
6. WHEN 系统生成题目，THE 系统 SHALL 遵循数学运算优先级（先乘除后加减）
7. WHEN 系统生成题目，THE 系统 SHALL 确保答案为正整数

### 需求 10：答题模式 - 答题界面

**用户故事：** 作为用户，我想通过数字键盘输入答案，以便快速答题

#### 验收标准

1. WHEN 答题模式比赛开始，THE 系统 SHALL 在赛道上方显示当前题目
2. WHEN 答题模式比赛进行中，THE 系统 SHALL 显示数字键盘（0-9）和删除、确认按钮
3. WHEN 用户点击数字键，THE 系统 SHALL 在答案输入框中显示该数字
4. WHEN 用户点击删除键，THE 系统 SHALL 删除答案输入框中的最后一位数字
5. WHEN 用户点击确认键，THE 系统 SHALL 记录用户答案并显示下一题
6. WHEN 用户确认答案，THE 系统 SHALL 推进用户的比赛进度
7. WHEN 答题过程中，THE 系统 SHALL 不校验答案正确性

### 需求 11：答题模式 - 结果展示

**用户故事：** 作为用户，我想在比赛结束后看到所有题目和答案，以便检查错误

#### 验收标准

1. WHEN 答题模式比赛结束，THE 系统 SHALL 在结果页面显示所有题目
2. WHEN 显示题目列表，THE 系统 SHALL 显示题目、用户答案、正确答案
3. WHEN 用户答案正确，THE 系统 SHALL 用绿色标记该题
4. WHEN 用户答案错误，THE 系统 SHALL 用红色标记该题并显示正确答案
5. WHEN 显示结果，THE 系统 SHALL 计算并显示正确率
6. WHEN 显示结果，THE 系统 SHALL 显示答对题数和答错题数
